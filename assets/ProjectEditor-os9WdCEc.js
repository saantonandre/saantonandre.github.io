var P=Object.defineProperty;var M=(e,t,r)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var E=(e,t,r)=>(M(e,typeof t!="symbol"?t+"":t,r),r);import{r as c,j as a,t as A,B as _}from"./index-dlmnP2Fs.js";import{B as N}from"./Basic-J2Bd3X-J.js";import{B as R}from"./Basic-viaTiaym.js";import{z as n,M as B,L as D,E as T,B as O}from"./ResourceEditor-KfLhM-Yf.js";import{s as C}from"./constants-pJ9mU_zC.js";import"./markdownConverter-cgldB2XP.js";function U({title:e,titleId:t,...r},s){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":t},r),e?c.createElement("title",{id:t},e):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.5 12.75l6 6 9-13.5"}))}const L=c.forwardRef(U),$=L,F=n.object({id:n.number(),url:n.string(),metadata:n.object({name:n.string(),short_name:n.string(),description:n.string(),instructions:n.string(),creation_date:n.string().refine(e=>!isNaN(new Date(e).valueOf()),{message:"Invalid date"}),thumbnail:n.string(),start_url:n.string(),width:n.string().refine(e=>!isNaN(Number(e)),{message:"Not a valid number"}),height:n.string().refine(e=>!isNaN(Number(e)),{message:"Not a valid number"}),links:n.array(B),resources:n.array(n.string()),mobile:n.boolean(),desktop:n.boolean()})}),V=["mobile","desktop"],q=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function X(e){return e.length===1?e[0].toString():e.reduce((t,r)=>{if(typeof r=="number")return t+"["+r.toString()+"]";if(r.includes('"'))return t+'["'+Z(r)+'"]';if(!q.test(r))return t+'["'+r+'"]';const s=t.length===0?"":".";return t+s+r},"")}function Z(e){return e.replace(/"/g,'\\"')}function G(e){return e.length!==0}const J=99,Q="; ",W=", or ",y="Validation error",z=": ";class H extends Error{constructor(r,s=[]){super(r);E(this,"details");E(this,"name");this.details=s,this.name="ZodValidationError"}toString(){return this.message}}function I(e){const{issue:t,issueSeparator:r,unionSeparator:s,includePath:l}=e;if(t.code==="invalid_union")return t.unionErrors.reduce((o,g)=>{const d=g.issues.map(u=>I({issue:u,issueSeparator:r,unionSeparator:s,includePath:l})).join(r);return o.includes(d)||o.push(d),o},[]).join(s);if(l&&G(t.path)){if(t.path.length===1){const o=t.path[0];if(typeof o=="number")return`${t.message} at index ${o}`}return`${t.message} at "${X(t.path)}"`}return t.message}function K(e,t,r){return t!==null?e.length>0?[t,e].join(r):t:e.length>0?e:y}function Y(e,t={}){const{maxIssuesInMessage:r=J,issueSeparator:s=Q,unionSeparator:l=W,prefixSeparator:o=z,prefix:g=y,includePath:d=!0}=t,u=e.errors.slice(0,r).map(b=>I({issue:b,issueSeparator:s,unionSeparator:l,includePath:d})).join(s),j=K(u,g,o);return new H(j,e.errors)}const ee=({className:e,onChange:t,...r})=>{const[s,l]=c.useState(r.defaultChecked);return a.jsxs("label",{role:"checkbox","aria-checked":s,className:A("dark:bg-d-neutral dark:text-d-contrast inline-block h-6 w-6 rounded-lg border-4 border-neutral bg-neutral2 text-contrast","cursor-pointer select-none",e),children:[s&&a.jsx($,{className:"w-full h-full stroke-2"}),a.jsx("input",{type:"checkbox",className:"hidden",onChange:o=>{l(o.target.checked),t==null||t(o)},...r})]})},te=["description","instructions"],le=({project:e})=>{const[t,r]=c.useState(!1),[s,l]=c.useState(!1),[o,g]=c.useState(crypto.randomUUID()),[d,u]=c.useState(e.metadata),j=C+"/project/edit/"+e.id,b=()=>{g(crypto.randomUUID()),r(!0)},v=()=>{r(!1),u(e.metadata)},w=async k=>{k.preventDefault(),l(!0);const h=F.shape.metadata.safeParse(d);if(h.success){const i=await fetch(j,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(h.data)}).then(p=>p.json());console.log(i),r(!1)}else console.error(Y(h.error));l(!1)};return a.jsxs(a.Fragment,{children:[a.jsx(N,{onClick:b,children:"EDIT METADATA"}),a.jsx(_,{open:t,close:v,title:"Editing project",loading:s,children:a.jsxs("form",{className:"flex flex-col gap-y-6 sm:grid sm:grid-cols-[max-content_auto]",onSubmit:w,children:[Object.entries(e.metadata).map(([k,h])=>{const i=k,p=String(h);let S=a.jsx(R,{required:!1,type:"text",defaultValue:p,className:"rounded-tl-none",onChange:m=>{const f=m.currentTarget.value||"";u(x=>({...x,[i]:f}))}});return V.includes(i)&&(S=a.jsx(ee,{required:!1,defaultChecked:p==="true",onChange:m=>{const f=m.currentTarget.checked;u(x=>({...x,[i]:f}))},className:"h-10 w-10 rounded-tl-none"})),i==="links"&&(S=a.jsx(D,{links:d.links,setData:m=>{u(f=>({...f,links:m}))}},"links"+o)),te.includes(i)&&(S=a.jsx(O,{required:!1,defaultValue:p,className:"rounded-tl-none",showMd:!0,onChange:m=>{const f=m.currentTarget.value||"";u(x=>({...x,[i]:f}))}})),a.jsxs(c.Fragment,{children:[a.jsx(T,{children:i}),S]},i+o)}),a.jsx("div",{className:"col-span-2 mt-10 flex justify-end",children:a.jsx(N,{type:"submit",children:"Submit"})})]})})]})};export{le as ProjectEditor,le as default};
