var P=Object.defineProperty;var A=(e,t,r)=>t in e?P(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var E=(e,t,r)=>A(e,typeof t!="symbol"?t+"":t,r);import{r as c,j as a,t as M,B as _}from"./index-CQbe2RcN.js";import{B as N}from"./Basic-Bkgc3bz1.js";import{B as R}from"./Basic-ClmRrspZ.js";import{B}from"./TextArea-BLsAGEfQ.js";import{z as s,M as D,L as T,E as O}from"./ResourceEditor-DihPL3Js.js";import{s as U}from"./constants-BrnciD3K.js";import"./markdownConverter-BWaZ0tGM.js";function C({title:e,titleId:t,...r},n){return c.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?c.createElement("title",{id:t},e):null,c.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const L=c.forwardRef(C),F=s.object({id:s.number(),url:s.string(),metadata:s.object({name:s.string(),short_name:s.string(),description:s.string(),instructions:s.string(),creation_date:s.string().refine(e=>!isNaN(new Date(e).valueOf()),{message:"Invalid date"}),thumbnail:s.string(),start_url:s.string(),width:s.string().refine(e=>!isNaN(Number(e)),{message:"Not a valid number"}),height:s.string().refine(e=>!isNaN(Number(e)),{message:"Not a valid number"}),links:s.array(D),resources:s.array(s.string()),mobile:s.boolean(),desktop:s.boolean()})}),$=["mobile","desktop"],V=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function q(e){return e.length===1?e[0].toString():e.reduce((t,r)=>{if(typeof r=="number")return t+"["+r.toString()+"]";if(r.includes('"'))return t+'["'+X(r)+'"]';if(!V.test(r))return t+'["'+r+'"]';const n=t.length===0?"":".";return t+n+r},"")}function X(e){return e.replace(/"/g,'\\"')}function Z(e){return e.length!==0}const G=99,J="; ",Q=", or ",y="Validation error",W=": ";class z extends Error{constructor(r,n=[]){super(r);E(this,"details");E(this,"name");this.details=n,this.name="ZodValidationError"}toString(){return this.message}}function v(e){const{issue:t,issueSeparator:r,unionSeparator:n,includePath:l}=e;if(t.code==="invalid_union")return t.unionErrors.reduce((o,g)=>{const d=g.issues.map(u=>v({issue:u,issueSeparator:r,unionSeparator:n,includePath:l})).join(r);return o.includes(d)||o.push(d),o},[]).join(n);if(l&&Z(t.path)){if(t.path.length===1){const o=t.path[0];if(typeof o=="number")return`${t.message} at index ${o}`}return`${t.message} at "${q(t.path)}"`}return t.message}function H(e,t,r){return t!==null?e.length>0?[t,e].join(r):t:e.length>0?e:y}function K(e,t={}){const{maxIssuesInMessage:r=G,issueSeparator:n=J,unionSeparator:l=Q,prefixSeparator:o=W,prefix:g=y,includePath:d=!0}=t,u=e.errors.slice(0,r).map(b=>v({issue:b,issueSeparator:n,unionSeparator:l,includePath:d})).join(n),j=H(u,g,o);return new z(j,e.errors)}const Y=({className:e,onChange:t,...r})=>{const[n,l]=c.useState(r.defaultChecked);return a.jsxs("label",{role:"checkbox","aria-checked":n,className:M("dark:bg-d-neutral dark:text-d-contrast inline-block h-6 w-6 rounded-lg border-4 border-neutral bg-neutral2 text-contrast","cursor-pointer select-none",e),children:[n&&a.jsx(L,{className:"w-full h-full stroke-2"}),a.jsx("input",{type:"checkbox",className:"hidden",onChange:o=>{l(o.target.checked),t==null||t(o)},...r})]})},ee=["description","instructions"],le=({project:e})=>{const[t,r]=c.useState(!1),[n,l]=c.useState(!1),[o,g]=c.useState(crypto.randomUUID()),[d,u]=c.useState(e.metadata),j=U+"/project/edit/"+e.id,b=()=>{g(crypto.randomUUID()),r(!0)},w=()=>{r(!1),u(e.metadata)},I=async k=>{k.preventDefault(),l(!0);const p=F.shape.metadata.safeParse(d);if(p.success){const i=await fetch(j,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(p.data)}).then(h=>h.json());console.log(i),r(!1)}else console.error(K(p.error));l(!1)};return a.jsxs(a.Fragment,{children:[a.jsx(N,{onClick:b,children:"EDIT METADATA"}),a.jsx(_,{open:t,close:w,title:"Editing project",loading:n,children:a.jsxs("form",{className:"flex flex-col gap-y-6 sm:grid sm:grid-cols-[max-content_auto]",onSubmit:I,children:[Object.entries(e.metadata).map(([k,p])=>{const i=k,h=String(p);let S=a.jsx(R,{required:!1,type:"text",defaultValue:h,className:"rounded-tl-none",onChange:m=>{const f=m.currentTarget.value||"";u(x=>({...x,[i]:f}))}});return $.includes(i)&&(S=a.jsx(Y,{required:!1,defaultChecked:h==="true",onChange:m=>{const f=m.currentTarget.checked;u(x=>({...x,[i]:f}))},className:"h-10 w-10 rounded-tl-none"})),i==="links"&&(S=a.jsx(T,{links:d.links,setData:m=>{u(f=>({...f,links:m}))}},"links"+o)),ee.includes(i)&&(S=a.jsx(B,{required:!1,defaultValue:h,className:"rounded-tl-none",showMd:!0,onChange:m=>{const f=m.currentTarget.value||"";u(x=>({...x,[i]:f}))}})),a.jsxs(c.Fragment,{children:[a.jsx(O,{children:i}),S]},i+o)}),a.jsx("div",{className:"col-span-2 mt-10 flex justify-end",children:a.jsx(N,{type:"submit",children:"Submit"})})]})})]})};export{le as ProjectEditor,le as default};
