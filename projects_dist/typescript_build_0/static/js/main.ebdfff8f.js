!function(){"use strict";var t={d:function(e,i){for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{assembleChunk:function(){return C},collided:function(){return E},cosSin:function(){return X},distance:function(){return j},getAngle:function(){return A},getRectSides:function(){return T},getRotation:function(){return Y},intersect:function(){return R},lineRectCol:function(){return M},pointRectCol:function(){return O}});var i={};t.r(i),t.d(i,{DmgVfx:function(){return F},ParticlesVfx:function(){return W},SpriteVfx:function(){return _},TextVfx:function(){return U}});var n=document.createElement("canvas");function s(t){t.style.position="absolute",t.style.left=(window.innerWidth-t.width)/2+"px",t.style.top=(window.innerHeight-t.height)/2+"px"}document.body.appendChild(n),n.width=800,n.height=600,window.oncontextmenu=function(t){t.preventDefault()},s(n),window.addEventListener("resize",(function(){return s(n)}));var o=n.getContext("2d");function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function h(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function l(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}o.imageSmoothingEnabled=!1;var c=new(l((function t(){var e=this;u(this,t),this.tilesize=16,this.baseRatio=2,this.ratio=this.baseRatio,this.fps=0,this.displayFps=!0,this.deltaTime=1,this.targetFrames=60,this.perfectFrameTime=1e3/this.targetFrames,this.lastTimestamp=Date.now(),this.timestamp=Date.now(),this.loopType=0,this.baseTilesWidth=25,this.baseTilesHeight=19,this.tilesWidth=this.baseTilesWidth,this.tilesHeight=this.baseTilesHeight,this.init=function(){if(e.displayFps){var t=document.createElement("span");t.style.position="absolute",t.style.color="white",t.style.left="5px",t.style.top="5px",document.body.appendChild(t),setInterval((function(){e.fpsCounter(t)}),1e3)}},this.compute=function(){e.fps+=1,e.updateDeltaTime()},this.updateDeltaTime=function(){e.lastTimestamp=e.timestamp,e.timestamp=Date.now(),e.deltaTime=(e.timestamp-e.lastTimestamp)/e.perfectFrameTime,e.deltaTime>2&&(e.deltaTime=2)},this.fpsCounter=function(t){t.innerHTML=String(e.fps),e.fps=0},this.init()})));function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},y(t,e)}function d(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}function x(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=v(t);if(e){var s=v(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===r(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}(this,i)}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function p(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"===typeof t)return m(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?m(t,e):void 0}}(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var n=0,s=function(){};return{s:s,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){h=!0,o=t},f:function(){try{r||null==i.return||i.return()}finally{if(h)throw o}}}}function w(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!t.solid)return!1;if(function(t,e){var i,n=p(e);try{for(n.s();!(i=n.n()).done;){var s=i.value;if(!k(t,s)&&P(t,s)){if(t.onCollision&&t.onCollision(s),s.onCollision&&s.onCollision(t),V(t,s))continue;S(t,s)}}}catch(o){n.e(o)}finally{n.f()}}(t,e),t.xVel+t.xVelExt!==0||t.yVel+t.yVelExt!==0){for(var n=t.xVel+t.xVelExt,s=t.yVel+t.yVelExt,o=t.hitbox?t.hitbox:t,r={x:n>0?o.x:o.x+n*i,y:s>0?o.y:o.y+s*i,w:n>0?o.w+n*i:o.w-n*i,h:s>0?o.h+s*i:o.h-s*i},h=[],a={value:0},l={x:0,y:0},u={x:0,y:0},c=!1,f=0;f<e.length;f++){var y=e[f];if(!k(t,y))if(P(r,y))if(g(o,y.hitbox?y.hitbox:y,n,s,i,l,u,a)){if(t.onCollision&&t.onCollision(y,e),y.onCollision&&"levelChange"===y.onCollision(t,e))return void(c=!0);if(V(t,y))continue;h.push({id:f,ct:a.value})}}if(!c&&0!==h.length){h.sort((function(t,e){return t.ct-e.ct}));for(var d=0,v=h;d<v.length;d++){b(t,i,e[v[d].id])}0!=n&&0!=s&&w(t,e,i)}}}function b(t,e,i){var n={x:0,y:0},s={value:0},o=t.xVel+t.xVelExt,r=t.yVel+t.yVelExt;if(g(t.hitbox?t.hitbox:t,i.hitbox?i.hitbox:i,o,r,e,{x:0,y:0},n,s)){var h=1.001;return t.xVel+=n.x*Math.abs(t.xVel)*(1-s.value)*h,t.yVel+=n.y*Math.abs(t.yVel)*(1-s.value)*h,t.xVelExt+=n.x*Math.abs(t.xVelExt)*(1-s.value)*h,t.yVelExt+=n.y*Math.abs(t.yVelExt)*(1-s.value)*h,!0}return!1}function g(t,e,i,n,s,o,r,h){if(0==i&&0==n)return!1;h.value=0;var a={x:e.x-t.w/2,y:e.y-t.h/2,w:e.w+t.w,h:e.h+t.h};return!!function(t,e,i,n,s,o){n.x=0,n.y=0,s.x=0,s.y=0;var r={x:1/e.x,y:1/e.y},h={x:(i.x-t.x)*r.x,y:(i.y-t.y)*r.y},a={x:(i.x+i.w-t.x)*r.x,y:(i.y+i.h-t.y)*r.y};if(isNaN(a.y)||isNaN(a.x))return!1;if(isNaN(h.y)||isNaN(h.x))return!1;if(h.x>a.x){var l=h.x;h.x=a.x,a.x=l}if(h.y>a.y){var u=h.y;h.y=a.y,a.y=u}if(h.x>a.y||h.y>a.x)return!1;if(o.value=Math.max(h.x,h.y),Math.min(a.x,a.y)<0)return!1;n.x=t.x+o.value*e.x,n.y=t.y+o.value*e.y,h.x>h.y?r.x<0?(s.x=1,s.y=0):(s.x=-1,s.y=0):h.x<h.y&&(r.y<0?(s.x=0,s.y=1):(s.x=0,s.y=-1));return!0}({x:t.x+t.w/2,y:t.y+t.h/2},{x:i*s,y:n*s},a,o,r,h)&&(h.value>=0&&h.value<1)}function k(t,e){return!(!e.removed&&e!=t)}function V(t,e){return!(e.solid&&!e.removed&&e!=t&&(!e.grounded||t.grounded))}function P(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.hitbox&&!i?t.hitbox:t,s=e.hitbox&&!i?e.hitbox:e;return n.x<s.x+s.w&&n.x+n.w>s.x&&n.y<s.y+s.h&&n.y+n.h>s.y}function S(t,e){if(null==t||null==e)return!0;var i=t.hitbox||t,n=e.hitbox||e,s=i.x+i.w/2-(n.x+n.w/2),o=i.y+i.h/2-(n.y+n.h/2),r=i.w/2+n.w/2,h=i.h/2+n.h/2,a="";if(Math.abs(s)<r&&Math.abs(o)<h){var l=r-Math.abs(s),u=h-Math.abs(o);l>=u?o>0?(a="t",t.col.T<u&&u>.01&&(t.col.T+=u)):(a="b",t.col.B<u&&u>.01&&(t.col.B+=u)):s>0?(a="l",t.col.L<l&&l>.01&&(t.col.L+=l)):(a="r",t.col.R<l&&l>.01&&(t.col.R+=l))}return a}function C(t,e){var i=[],n=[];if(1==t.length)return t;for(var s=0;s<t.length;s++)for(var o=0;o<t[s].w;o++)for(var r=0;r<t[s].h;r++){var h={x:t[s].x+o,y:t[s].y+r,w:1,h:1};E(e,h)&&n.push(h)}if(0==n.length)return[];var a,l,u={x:n[0].x,y:n[0].y,w:n[0].w,h:n[0].h};i.push(u);for(var c=0;c<n.length;c++)for(var f=0;f<i.length;f++)if(a=void 0!==n[c].hitbox?n[c].hitbox:n[c],l=i[f],a.y==l.y&&a.h==l.h)a.x+a.w>l.x+l.w&&(l.w=a.x+a.w-l.x),a.x<l.x&&(l.w+=l.x-a.x,l.x=a.x);else if(a.x==l.x&&a.w==l.w)a.y+a.h>l.y+l.h&&(l.h=a.y+a.h-l.y),a.y<l.y&&(l.h+=l.y-a.y,l.y=a.y);else{var y={x:a.x,y:a.y,w:a.w,h:a.h};i.push(y)}return i}function E(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n="undefined"===typeof t.hitbox||i?t:t.hitbox,s="undefined"===typeof e.hitbox||i?e:e.hitbox;return n.x<s.x+s.w&&n.x+n.w>s.x&&n.y<s.y+s.h&&n.y+n.h>s.y}function O(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.hitbox&&!i?e.hitbox:e;return t.x>=n.x&&t.x<=n.x+n.w&&t.y>=n.y&&t.y<=n.y+n.h}function M(t,e){for(var i=T(e),n=0;n<i.length;n++)if(R(i[n].x1,i[n].y1,i[n].x2,i[n].y2,t.x1,t.y1,t.x2,t.y2))return!0;return!1}function R(t,e,i,n,s,o,r,h){if(t===i&&e===n||s===r&&o===h)return!1;var a=(h-o)*(i-t)-(r-s)*(n-e);if(0===a)return!1;var l=((r-s)*(e-o)-(h-o)*(t-s))/a,u=((i-t)*(e-o)-(n-e)*(t-s))/a;return!(l<0||l>1||u<0||u>1)&&{x:t+l*(i-t),y:e+l*(n-e)}}function T(t){var e=[],i=t;return void 0!==t.hitbox&&(i=t.hitbox),e.push({x1:i.x,y1:i.y,x2:i.x+i.w,y2:i.y}),e.push({x1:i.x+i.w,y1:i.y,x2:i.x+i.w,y2:i.y+i.h}),e.push({x1:i.x+i.w,y1:i.y+i.h,x2:i.x,y2:i.y+i.h}),e.push({x1:i.x,y1:i.y+i.h,x2:i.x,y2:i.y}),e}function A(t){var e=t.x1,i=t.y1,n=t.x2-e,s=t.y2-i;return Math.atan2(s,n)}function X(t){var e=A({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2});return[Math.cos(e),Math.sin(e)]}function Y(t,e){return A({x1:t.x+t.w/2,y1:t.y+t.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2})}function j(t,e){var i=t.w?t.x+t.w/2:t.x,n=t.h?t.y+t.h/2:t.y,s=e.w?e.x+e.w/2:e.x,o=e.h?e.y+e.h/2:e.y;return Math.sqrt(Math.pow(i-s,2)+Math.pow(n-o,2))}var D=new Image;D.src="images/spritesheet.png";var z=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;u(this,t),this.x=void 0,this.y=void 0,this.w=void 0,this.h=void 0,this.sheet=D,this.animation="idle",this.animations={},this.display=!0,this.left=0,this.frame=0,this.frameCounter=0,this.removed=!1,this.rot=0,this.x=e,this.y=i,this.w=n,this.h=s}return l(t,[{key:"loadAnimation",value:function(t){return this.animation!==t&&(this.frameCounter=0,this.frame=0,this.animation=t,!0)}},{key:"onAnimationEnd",value:function(){}},{key:"renderHitbox",value:function(t,e,i,n){}},{key:"renderItem",value:function(t,e,i,n,s){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;i.drawImage(this.sheet,this.animations.idle.keyframesX[0][0]*n,this.animations.idle.keyframesY[0][0]*n,this.animations.idle.w*n,this.animations.idle.h*n,t*n*s,e*n*s,o*n*s,r*n*s)}},{key:"updateSprite",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.frameCounter+=t,this.frameCounter>=this.animations[this.animation].slowness&&(this.frame++,this.frameCounter=0),this.frame>=this.animations[this.animation].keyframesX[this.left].length&&(this.frame=0,this.frameCounter=0,this.onAnimationEnd())}},{key:"setAnimation",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.animations[t]||(this.animations[t]=new I(this)),n?(this.animations[t].keyframesX[1]=e,this.animations[t].keyframesY[1]=i):(this.animations[t].keyframesX[0]=e,this.animations[t].keyframesY[0]=i,this.animations[t].keyframesX[1]=e,this.animations[t].keyframesY[1]=i)}},{key:"renderSprite",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:this.w/2,y:this.h/2};this.display&&(this.removed,this.rot?(t.save(),t.translate((this.x+this.animations[this.animation].offsetX+s.x+n.x)*e*i,(this.y+this.animations[this.animation].offsetY+s.y+n.y)*e*i),t.rotate(this.rot),t.drawImage(this.sheet,this.animations[this.animation].keyframesX[this.left][this.frame]*e,this.animations[this.animation].keyframesY[this.left][this.frame]*e,this.animations[this.animation].w*e,this.animations[this.animation].h*e,-s.x*e*i,-s.y*e*i,this.animations[this.animation].w*e*i,this.animations[this.animation].h*e*i),t.restore()):t.drawImage(this.sheet,this.animations[this.animation].keyframesX[this.left][this.frame]*e,this.animations[this.animation].keyframesY[this.left][this.frame]*e,this.animations[this.animation].w*e,this.animations[this.animation].h*e,(this.x+this.animations[this.animation].offsetX+n.x)*e*i,(this.y+this.animations[this.animation].offsetY+n.y)*e*i,this.animations[this.animation].w*e*i,this.animations[this.animation].h*e*i))}},{key:"renderSquare",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:this.w/2,y:this.h/2};this.display&&(this.removed&&console.log("rendering a removed entity!!!"),this.rot?(t.save(),t.translate((this.x+s.x+n.x)*e*i,(this.y+s.y+n.y)*e*i),t.rotate(this.rot),t.fillRect(-s.x*e*i,-s.y*e*i,this.w*e*i,this.h*e*i),t.restore()):t.fillRect((this.x+n.x)*e*i,(this.y+n.y)*e*i,this.w*e*i,this.h*e*i))}}]),t}(),I=l((function t(e){u(this,t),this.keyframesX=void 0,this.keyframesY=void 0,this.slowness=void 0,this.w=void 0,this.h=void 0,this.offsetX=void 0,this.offsetY=void 0,this.keyframesX=[[],[]],this.keyframesY=[[],[]],this.slowness=6,this.w=e.w,this.h=e.h,this.offsetX=(e.w-this.w)/2,this.offsetY=(e.h-this.h)/2}));function L(t,e,i){return(e=h(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function H(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}var B=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ad2f45",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"center",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"middle";u(this,t),this.content="",this.x=void 0,this.y=void 0,this.color=void 0,this.align=void 0,this.baseline=void 0,this.fontSize=7,this.font="Consolas, monaco, monospace",this.shadow=!1,this.shadowColor="#14182e",this.strokeWidth=.3,this.stroke=void 0,this.strokeColor=void 0,this.x=e,this.y=i,this.color=n,this.align=s,this.stroke=!1,this.baseline=o,this.strokeColor="#ffffff"}return l(t,[{key:"shadowOffsetX",get:function(){return this.fontSize/200}},{key:"shadowOffsetY",get:function(){return this.fontSize/200}},{key:"canvasFont",value:function(t){return"bold "+Math.round(this.fontSize*t)+"px "+this.font}},{key:"render",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};if(this.stroke&&(t.lineWidth=this.strokeWidth*i,t.strokeStyle=this.strokeColor),t.textBaseline=this.baseline,t.textAlign=this.align,t.fillStyle=this.color,t.font=this.canvasFont(i),"string"!==typeof this.content)for(var s=0;s<this.content.length;s++)this.stroke&&t.strokeText(this.content[s],(this.x+n.x)*e*i,((this.y+n.y)*e+this.fontSize*s)*i),this.shadow&&(t.fillStyle=this.shadowColor,t.fillText(this.content[s],(this.x+n.x+this.shadowOffsetX)*e*i,((this.y+n.y+this.shadowOffsetY)*e+this.fontSize*s)*i)),t.fillStyle=this.color,t.fillText(this.content[s],(this.x+n.x)*e*i,((this.y+n.y)*e+this.fontSize*s)*i);else this.stroke&&t.strokeText(this.content,(this.x+n.x)*e*i,(this.y+n.y)*e*i),this.shadow&&(t.fillStyle=this.shadowColor,t.fillText(this.content,(this.x+n.x+this.shadowOffsetX)*e*i,(this.y+n.y+this.shadowOffsetY)*e*i)),t.fillStyle=this.color,t.fillText(this.content,(this.x+n.x)*e*i,(this.y+n.y)*e*i)}}]),t}(),_=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t.centerX,t.centerY)).source=void 0,n.type="vfx",n.name="proto",n.removed=!1,n.randomPos=!1,n.randomAmount=.5,n.source=t,n}return l(i,[{key:"resolveCollisions",value:function(){}},{key:"renderShadow",value:function(){}},{key:"randomizePos",value:function(){this.x+=Math.random()*this.randomAmount-this.randomAmount/2,this.y+=Math.random()*this.randomAmount-this.randomAmount/2}},{key:"reset",value:function(t){this.source=t,this.moveAtSource(),this.randomPos&&this.randomizePos(),this.removed=!1,this.frame=0,this.frameCounter=0,this.additionalResetOperations()}},{key:"additionalResetOperations",value:function(){}},{key:"moveAtSource",value:function(){this.x=this.source.centerX-this.w/2,this.y=this.source.centerY-this.h/2}},{key:"compute",value:function(t){this.updateSprite(t)}},{key:"render",value:function(t,e,i,n){this.renderSprite(t,e,i,n)}},{key:"onAnimationEnd",value:function(){this.removed=!0}}]),i}(z),F=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t)).name="DmgVfx",n.w=1,n.h=1,n.randomPos=!0,n.randomizePos(),n.setAnimation("boom",[17,17,17,17],[0,1,2,3]),n.setAnimation("cut",[18,18,18,18],[0,1,2,3]),n.setAnimation("cut_long",[20,20,20,20],[0,1,2,3]),n.animations.cut_long.w=2,n.additionalResetOperations(),n}return l(i,[{key:"additionalResetOperations",value:function(){var t=Object.entries(this.animations);this.animation=t[Math.random()*t.length|0][0];var e=[0,90,180,-90];this.rot=e[Math.random()*e.length|0]}}]),i}(_),N=function(t){d(i,t);var e=x(i);function i(t){var n,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return u(this,i),(n=e.call(this,t.x,t.y)).verticalSpeed=-.03,n.x=void 0,n.y=void 0,n.source=void 0,n.lifeCycles=void 0,n.remainingCycles=void 0,n.setAnimation("idle",[19,19,19,19],[0,1,2,3]),n.source=t,n.lifeCycles=s,n.remainingCycles=n.lifeCycles,n.x=t.x+t.w/2+1.5*Math.random()-.75-n.w/2,n.y=t.y+t.h/2+1.5*Math.random()-.75-n.h/2,n.x-=n.w/2,n.y-=n.h/2,n}return l(i,[{key:"randomX",get:function(){return this.source.x+this.source.w/2+1.5*Math.random()-.75-this.w/2}},{key:"randomY",get:function(){return this.source.y+this.source.h/2+1.5*Math.random()-.75-this.h/2}},{key:"reset",value:function(t,e){this.source=t,this.x=this.randomX,this.y=this.randomY,this.removed=!1,this.remainingCycles=e||this.lifeCycles}},{key:"onAnimationEnd",value:function(){this.remainingCycles--,this.remainingCycles<=0?this.removed=!0:(this.x=this.randomX,this.y=this.randomY)}},{key:"compute",value:function(t){this.y+=this.verticalSpeed*t,this.updateSprite(t)}},{key:"render",value:function(t,e,i,n){this.renderSprite(t,e,i,n)}}]),i}(z),W=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t)).particlesDuration=5,n.particlesAmount=5,n.particles=[],n.name="ParticlesVfx",n.particlesDuration=5,n.particlesAmount=5,n.particles=[],n.initialize(),n}return l(i,[{key:"initialize",value:function(){for(var t=0;t<this.particlesAmount;t++)this.particles.push(new N(this.source,this.particlesDuration))}},{key:"additionalResetOperations",value:function(){var t,e=p(this.particles);try{for(e.s();!(t=e.n()).done;){t.value.reset(this.source,this.particlesDuration)}}catch(i){e.e(i)}finally{e.f()}}},{key:"compute",value:function(t){var e,i=0,n=p(this.particles);try{for(n.s();!(e=n.n()).done;){var s=e.value;s.removed?i++:s.compute(t)}}catch(o){n.e(o)}finally{n.f()}i===this.particles.length&&(this.removed=!0)}},{key:"render",value:function(t,e,i,n){var s,o=p(this.particles);try{for(o.s();!(s=o.n()).done;){var r=s.value;r.removed||r.render(t,e,i,n)}}catch(h){o.e(h)}finally{o.f()}}}]),i}(_),U=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t)).name="TextVfx",n.text=new B(0,0),n.progress=0,n.text.content="",n.text.color="#ad2f45",n.text.shadow=!0,n.text.fontSize=10,n}return l(i,[{key:"reset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.removed=!1,this.progress=0,this.text.content=e,this.source=t}},{key:"compute",value:function(t){this.progress+=Math.PI/60*t,this.progress>=Math.PI?this.removed=!0:(this.x=this.source.centerX+this.progress/10,this.y=this.source.centerY-Math.sin(this.progress),this.text.x=this.x,this.text.y=this.y)}},{key:"render",value:function(t,e,i,n){this.text.render(t,e,i,n)}}]),i}(_),q=function(){function t(){var e=this;u(this,t),this.recyclePool=[],this.environment=[],this.vfxClasses=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?H(Object(i),!0).forEach((function(e){L(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):H(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},i),this.create=function(t,i){var n=e.getRecycledVfx(t,i)||new e.vfxClasses[t](i);return e.environment.push(n),n}}return l(t,[{key:"setEnvironment",value:function(t){this.environment=t}},{key:"getRecycledVfx",value:function(t,e){for(var i=this.recyclePool.length-1;i>=0;i--)if(this.recyclePool[i].name===t)return this.recyclePool[i].reset(e),this.recyclePool.splice(i,1)[0];return!1}}]),t}(),$=new q,G=l((function t(){var e=this;u(this,t),this.playbackRate=1,this.volume=1,this.sounds={playRandom:function(t){e.sounds[t[Math.random()*t.length|0]].play()}},this.soundsBaseUrl="assets/soundFxs/",this.createSound=function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o="".concat(e.soundsBaseUrl).concat(t,".mp3"),r=t.split("/"),h=r[r.length-1];e.sounds[h]=new J(o,i,n,s)}})),J=l((function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;u(this,t),this.audio=void 0,this.loop=!1,this.volume=1,this.playbackRate=1,this.calledPlayPromise=!1,this.play=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(i.calledPlayPromise)return!1;if(i.audio.volume=i.volume*t,i.audio.loop=i.loop,i.audio.playbackRate=i.playbackRate*e,i.audio.paused)i.audio.loop||(i.audio.currentTime=0);else{if(i.audio.loop)return;i.audio.pause(),i.audio.currentTime=0}var n=i.audio.play();i.calledPlayPromise=!0,void 0!==n&&n.catch((function(t){console.warn("there was an audio error!",t),i.calledPlayPromise=!1})).then((function(){i.calledPlayPromise=!1}))},this.audio=new Audio(e),this.loop=n,this.volume=s,this.playbackRate=o})),K=new G,Q=function(t){d(n,t);var i=x(n);function n(){var t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u(this,n),(t=i.call(this,s,o)).xVel=0,t.yVel=0,t.xVelExt=0,t.yVelExt=0,t.speed=.1,t.friction=0,t.type="entity",t.state="idle",t.sounds=K.sounds,t.stats=new Z,t.background=!1,t.grounded=!1,t.damaged=0,t.shadow=!1,t.solid=!0,t.removed=!1,t.immovable=!1,t.currentRoom=-1,t.drops=[],t.offsetX=0,t.offsetY=0,t.Physics=e,t.hasHpBar=!1,t.hasDisplayName=!1,t.col={L:0,R:0,T:0,B:0},t.hitbox={x:0,y:0,w:0,h:0},t.hitboxOffset={x:0,y:0,w:0,h:0},t.createVfx=$.create,t.checkCollisions=w,t.updateHitbox(),t}return l(n,[{key:"atk",get:function(){return this.stats.atk}},{key:"hp",get:function(){return this.stats.hp},set:function(t){this.stats.hp=t}},{key:"centerX",get:function(){return this.x+this.w/2}},{key:"centerY",get:function(){return this.y+this.h/2}},{key:"updateHitbox",value:function(){this.hitbox.x=this.x+this.hitboxOffset.x,this.hitbox.y=this.y+this.hitboxOffset.y,this.hitbox.w=this.w+this.hitboxOffset.w,this.hitbox.h=this.h+this.hitboxOffset.h}},{key:"onCollision",value:function(t){}},{key:"resolveCollisions",value:function(){this.col.L&&this.xVel+this.xVelExt<0&&(this.xVel=0,this.xVelExt=0),this.col.R&&this.xVel+this.xVelExt>0&&(this.xVel=0,this.xVelExt=0),this.col.T&&this.yVel+this.yVelExt<0&&(this.yVel=0,this.yVelExt=0),this.col.B&&this.yVel+this.yVelExt>0&&(this.yVel=0,this.yVelExt=0),this.col.L=0,this.col.R=0,this.col.T=0,this.col.B=0}},{key:"onHit",value:function(t){this.xVelExt=t.xVel,this.yVelExt=t.yVel}},{key:"updateVelocities",value:function(t){0!==this.xVelExt&&(this.xVelExt*=Math.pow(this.friction,t),Math.abs(this.xVelExt)<.001&&(this.xVelExt=0)),0!==this.yVelExt&&(this.yVelExt*=Math.pow(this.friction,t),Math.abs(this.yVelExt)<.001&&(this.yVelExt=0))}},{key:"updatePosition",value:function(t){this.resolveCollisions(),this.x+=(this.xVel+this.xVelExt)*t,this.y+=(this.yVel+this.yVelExt)*t}},{key:"compute",value:function(t){}},{key:"render",value:function(t,e,i,n){this.renderSquare(t,e,i,n)}},{key:"renderHitbox",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};t.strokeStyle="red",t.beginPath(),t.strokeRect((this.hitbox.x+n.x)*e*i,(this.hitbox.y+n.y)*e*i,this.hitbox.w*e*i,this.hitbox.h*e*i),t.closePath(),t.stroke()}},{key:"renderShadow",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};this.shadow&&!this.removed&&(t.fillStyle="#14182e",t.globalAlpha=.6,t.strokeStyle="#ffffff",t.beginPath(),t.ellipse((this.x+n.x+this.w/2)*e*i,(this.y+this.h+n.y)*e*i,this.w/2*e*i,this.w/4*e*i,0,0,2*Math.PI),t.closePath(),t.fill(),t.globalAlpha=1)}}]),n}(z),Z=l((function t(){u(this,t),this.lv=void 0,this.maxHp=void 0,this.hp=void 0,this.maxExp=void 0,this.exp=void 0,this.maxMana=void 0,this.mana=void 0,this.atk=void 0,this.atkSpeed=void 0,this.expValue=void 0,this.lv=1,this.maxHp=10,this.hp=this.maxHp,this.maxExp=10,this.exp=0,this.maxMana=15,this.mana=this.maxMana,this.atk=1,this.atkSpeed=1,this.expValue=1})),tt=Q,et=function(){function t(){u(this,t),this.up=void 0,this.down=void 0,this.left=void 0,this.right=void 0,this.upR=void 0,this.downR=void 0,this.leftR=void 0,this.rightR=void 0,this.spacebar=void 0,this.e=void 0,this.lClickDown=void 0,this.mClickDown=void 0,this.rClickDown=void 0,this.test=void 0,this.currentPos=void 0,this.lastDir=void 0,this.mouseX=void 0,this.mouseY=void 0,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.upR=!1,this.downR=!1,this.leftR=!1,this.rightR=!1,this.spacebar=!1,this.e=!1,this.lClickDown=!1,this.mClickDown=!1,this.rClickDown=!1,this.test="test",this.currentPos=0,this.lastDir=0,this.mouseX=0,this.mouseY=0,this.initListeners()}return l(t,[{key:"initListeners",value:function(){document.addEventListener("mousedown",i),document.addEventListener("mouseup",i),document.addEventListener("keydown",e),document.addEventListener("keyup",e);var t=this;function e(e){var i="keydown"===e.type;switch(e.key){case"w":t.up=i;break;case"s":t.down=i;break;case"a":t.left=i;break;case"d":t.right=i;break;case"ArrowUp":t.upR=i;break;case"ArrowDown":t.downR=i;break;case"ArrowLeft":t.leftR=i;break;case"ArrowRight":t.rightR=i;break;case" ":t.spacebar=i;break;case"e":t.e=i;break;case"Escape":case"y":break;default:console.log('Pressed "'.concat(e.key,'" key'))}}function i(e){var i="mousedown"===e.type;switch(e.button){case 0:t.lClickDown=i;break;case 1:t.mClickDown=i;break;case 2:t.rClickDown=i}t.mouseX=e.clientX,t.mouseY=e.clientY}}}]),t}(),it=l((function t(e,i,n){var s=this;u(this,t),this.x=0,this.y=0,this.canvas=void 0,this.meta=void 0,this.camera=void 0,this.absolute={x:0,y:0,hoverUI:!1,dragging:!1,slot:{}},this.lastMouseX=0,this.lastMouseY=0,this.updatePos=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clientX:s.lastMouseX,clientY:s.lastMouseY};s.lastMouseX=t.clientX,s.lastMouseY=t.clientY,s.x=-s.camera.x+(t.clientX-s.canvas.offsetLeft)/s.meta.tilesize/s.meta.ratio,s.y=-s.camera.y+(t.clientY-s.canvas.offsetTop)/s.meta.tilesize/s.meta.ratio,s.absolute.x=(t.clientX-s.canvas.offsetLeft)/s.meta.tilesize/s.meta.ratio,s.absolute.y=(t.clientY-s.canvas.offsetTop)/s.meta.tilesize/s.meta.ratio},this.canvas=e,this.meta=i,this.camera=n,document.addEventListener("mousemove",this.updatePos)})),nt=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t.x,t.y)).source=void 0,n.rot=t.rot+1,n.w=4,n.h=3,n.source=t,n.setAnimation("idle",[2],[0]),n}return l(i,[{key:"follow",value:function(t){this.x+=(this.source.x+this.source.w/2-this.w/2-this.x)/3*t,this.y+=(this.source.y+this.source.h/2-this.h/2-this.y)/3*t;var e=this.source.rot+1;e-this.rot>Math.PI?this.rot+=2*Math.PI:e-this.rot<-Math.PI?this.rot-=2*Math.PI:this.rot+=(e-this.rot)/12*t}},{key:"attack",value:function(){}},{key:"render",value:function(t,e,i,n){var s={x:this.w/2,y:this.h/2};this.renderSprite(t,e,i,n,s)}}]),i}(tt),st=function(t){d(i,t);var e=x(i);function i(t,n,s,o,r){var h;return u(this,i),(h=e.call(this,t,n)).controls=void 0,h.mouse=void 0,h.scythe=void 0,h.mantle=void 0,h.mouse=new it(s,o,r),h.controls=new et,h.w=1,h.h=1,h.setAnimation("idle",[0],[0]),h.scythe=new nt(f(h)),h.mantle=new z(h.x,h.y),h.mantle.w=2,h.mantle.h=2,h.mantle.setAnimation("idle",[0,0,0,0],[1,3,5,7]),h}return l(i,[{key:"resolveInputs",value:function(){!this.controls.left||this.controls.right||this.col.L?this.xVel<0&&(this.xVel=0):(this.xVel=-this.speed,this.left=1),!this.controls.right||this.controls.left||this.col.R?this.xVel>0&&(this.xVel=0):(this.xVel=this.speed,this.left=0),!this.controls.up||this.controls.down||this.col.B?this.yVel<0&&(this.yVel=0):this.yVel=-this.speed,!this.controls.down||this.controls.up||this.col.T?this.yVel>0&&(this.yVel=0):this.yVel=this.speed,this.controls.left||this.controls.right||this.controls.up||this.controls.down||(this.xVel=0,this.yVel=0),+this.controls.left+ +this.controls.right+ +this.controls.up+ +this.controls.down>1&&(this.xVel/=1.42,this.yVel/=1.42)}},{key:"compute",value:function(t){this.rot=this.Physics.getAngle({x1:this.x+this.w/2,y1:this.y+this.h/2,x2:this.mouse.x,y2:this.mouse.y})+2*Math.PI,this.resolveInputs(),this.updateVelocities(t),this.updatePosition(t),this.updateHitbox(),this.scythe.follow(t),this.mantle.updateSprite(t),this.mantle.x+=(this.x+this.w/2-this.mantle.w/2-this.mantle.x)/5*t,this.mantle.y+=(this.y+this.h/2-this.mantle.h/2-this.mantle.y)/5*t,this.mantle.rot=this.rot}},{key:"render",value:function(t,e,i,n){this.mantle.renderSprite(t,e,i,n),this.scythe.render(t,e,i,n),this.renderSprite(t,e,i,n)}}]),i}(Q),ot=[];console.log(ot),c.tilesize=32,c.ratio=1;var rt={x:0,y:0};ot.push(new st(5,5,n,c,rt));!function t(e){o.clearRect(0,0,n.width,n.height),e.compute();for(var i=0,s=ot;i<s.length;i++){s[i].compute(e.deltaTime)}for(var r=0,h=ot;r<h.length;r++){h[r].render(o,e.tilesize,e.ratio,rt)}e.compute(),requestAnimationFrame((function(){return t(e)}))}(c)}();
//# sourceMappingURL=main.ebdfff8f.js.map