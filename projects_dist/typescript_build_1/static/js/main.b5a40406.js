!function(){"use strict";var t={d:function(e,i){for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r:function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{assembleChunk:function(){return E},collided:function(){return W},cosSin:function(){return j},distance:function(){return D},getAngle:function(){return L},getRectSides:function(){return X},getRectsAngle:function(){return Y},getRotation:function(){return I},intersect:function(){return C},lineRectCol:function(){return T},pointRectCol:function(){return z}});var i={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t){var e=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===n(e)?e:String(e)}function s(t,e,i){return(e=o(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function l(t,e,i){return e&&h(t.prototype,e),i&&h(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function d(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function v(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function x(t){var e=v();return function(){var i,o=y(t);if(e){var s=y(this).constructor;i=Reflect.construct(o,arguments,s)}else i=o.apply(this,arguments);return function(t,e){if(e&&("object"===n(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,i)}}t.r(i),t.d(i,{DmgVfx:function(){return K},ParticlesVfx:function(){return q},SpriteVfx:function(){return Z},TextVfx:function(){return H}});var m=new Image;m.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAAAXNSR0IArs4c6QAAAMBQTFRFBgYIFBATOxclcxcttCAq3z4j+moK+aMb/9VB//xA1vJknNtDWcE1FKAuGno+JFI7EiAgFDRkKFzEJJ/eINbHpvzb/////vPA+ta49aCX6GpzvEqbeTqAQDNTJCI0IhwaMisocUE7u3VH26Rj9NKc2uDqs7nRi5OvbXWNSlRiMzlBQiQzWzE4jlJSunVq6bWj4+b/ub/7hJvkWI2+R32FI2dOMoRkXa+Nkty6zffi5NKqx7CLoIZieWdVWk5EQjk0Nj8ZnAAAAEB0Uk5TAP///////////////////////////////////////////////////////////////////////////////////xMrnjEAAAsvSURBVHic7Z1rc+K4EoY5BdnKjsFWyMYw+8VDVSpUKGKTfCBh//8PO92SfMX4KmIFvw9Xm+Bhnmq1pbYFk4lBdrudyc3dNLv37Ra2mkGufMhqhnQFWY2Aq+aM0NVms2n/JjY0RldhGLW2tXvckav30bmahVE0u2v3pt2jlDU6V+FM0u5dJOuRXY2rP7rZzO7CZ4qslg2RbS3HFVacryhjPUdR9HzZ1vF4nM8L68Lw8X5p1NXU5MauAsliU+Tq+aKto5SVtxX6fvi4XBpshdOZ9bY2YaQgZRdkHSX3eVskax0uCVO2ppQ27beVuLpgS7k6/vmTsxWSq93OrCvrbUlXG9USK2Xd50NrF4Z8b9bV7C+7bW2en8lVWC/rLGul9K9naVd306nVtjaRclXbDAuRlaF/PSuJq5nlWX4TqRx/McGX56yU/vWsJK6sd0WmNnx3uetQujdM6D+WTl3ZnuF5EB3VdEqrMpYBV3/9FFeyB1+R3RVlPXiFiRrN9O5HtEEmGRu2faO5ehbF1s9w1bXqYLSeNWVXdvcaYjYzaonD1rN+SFwxXSqlhutZP8ZVtxq84XrWj3HViWI9K5SDRVBGsZ5Fyz5sXaBYz5LLw34keynWs0K4usxZPQspqxmn02noj/BjOL1vt7DVjBOPDyGrEdIVZDUCrkrwPK9sNVyV4J3LYkNwVYJ3Luv0eCJX7yN09Zto947To5Q1LlcbyYpop4tkPbKrUfVHN2HEx6RXUlebN55kPWtMqibx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";var p=function(){function t(e,i){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;u(this,t),this.x=void 0,this.y=void 0,this.w=void 0,this.h=void 0,this.sheet=m,this.animations={},this.animation="idle",this.display=!0,this.left=0,this.frame=0,this.frameCounter=0,this.removed=!1,this.rot=0,this.trackPos=!1,this.prevPos=[],this.addPos=function(){n.prevPos.unshift({x:n.x,y:n.y,rot:n.rot,opacity:.6})},this.x=e,this.y=i,this.w=o,this.h=s}return l(t,[{key:"centerX",get:function(){return this.x+this.w/2}},{key:"centerY",get:function(){return this.y+this.h/2}},{key:"centerPoint",get:function(){return{x:this.centerX,y:this.centerY}}},{key:"loadAnimation",value:function(t){return this.animation!==t&&(this.frameCounter=0,this.frame=0,this.animation=t,!0)}},{key:"onAnimationEnd",value:function(){}},{key:"renderHitbox",value:function(t,e,i,n){}},{key:"renderItem",value:function(t,e,i,n,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;i.drawImage(this.sheet,this.animations.idle.keyframesX[0][0]*n,this.animations.idle.keyframesY[0][0]*n,this.animations.idle.w*n,this.animations.idle.h*n,t*n*o,e*n*o,s*n*o,r*n*o)}},{key:"updateSprite",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.frameCounter+=t,this.frameCounter>=this.animations[this.animation].slowness&&(this.frame++,this.frameCounter=0),this.frame>=this.animations[this.animation].keyframesX[this.left].length&&(this.frame=0,this.frameCounter=0,this.onAnimationEnd())}},{key:"setAnimation",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.animations[t]||(this.animations[t]=new w(this)),n?(this.animations[t].keyframesX[1]=e,this.animations[t].keyframesY[1]=i):(this.animations[t].keyframesX[0]=e,this.animations[t].keyframesY[0]=i,this.animations[t].keyframesX[1]=e,this.animations[t].keyframesY[1]=i)}},{key:"renderSprite",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:this.w/2,y:this.h/2},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this;this.display&&(this.removed,s.rot?(s===this&&this.trackPos&&this.addPos(),t.save(),s.opacity&&(t.globalAlpha=s.opacity,t.filter="brightness(0)"),t.translate((s.x+this.animations[this.animation].offsetX+o.x+n.x)*e*i|0,(s.y+this.animations[this.animation].offsetY+o.y+n.y)*e*i|0),t.rotate(s.rot),t.drawImage(this.sheet,this.animations[this.animation].keyframesX[this.left][this.frame]*e,this.animations[this.animation].keyframesY[this.left][this.frame]*e,this.animations[this.animation].w*e,this.animations[this.animation].h*e,-o.x*e*i|0,-o.y*e*i|0,this.animations[this.animation].w*e*i|0,this.animations[this.animation].h*e*i|0),t.restore()):t.drawImage(this.sheet,this.animations[this.animation].keyframesX[this.left][this.frame]*e,this.animations[this.animation].keyframesY[this.left][this.frame]*e,this.animations[this.animation].w*e,this.animations[this.animation].h*e,(s.x+this.animations[this.animation].offsetX+n.x)*e*i|0,(s.y+this.animations[this.animation].offsetY+n.y)*e*i|0,this.animations[this.animation].w*e*i|0,this.animations[this.animation].h*e*i|0))}},{key:"renderSquare",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:this.w/2,y:this.h/2};this.display&&(this.removed&&console.log("rendering a removed entity!!!"),this.rot?(t.save(),t.translate((this.x+o.x+n.x)*e*i|0,(this.y+o.y+n.y)*e*i|0),t.rotate(this.rot),t.fillRect(-o.x*e*i|0,-o.y*e*i|0,this.w*e*i|0,this.h*e*i|0),t.restore()):(console.log("rendering player",(this.x+n.x)*e*i|0,(this.y+n.y)*e*i|0,this.w*e*i|0,this.h*e*i|0),t.fillRect((this.x+n.x)*e*i|0,(this.y+n.y)*e*i|0,this.w*e*i|0,this.h*e*i|0)))}}]),t}(),w=l((function t(e){u(this,t),this.keyframesX=void 0,this.keyframesY=void 0,this.slowness=void 0,this.w=void 0,this.h=void 0,this.offsetX=void 0,this.offsetY=void 0,this.keyframesX=[[],[]],this.keyframesY=[[],[]],this.slowness=6,this.w=e.w,this.h=e.h,this.offsetX=(e.w-this.w)/2,this.offsetY=(e.h-this.h)/2}));function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function g(t,e){if(t){if("string"===typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?b(t,e):void 0}}function A(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=g(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return r=t.done,t},e:function(t){a=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(a)throw s}}}}function k(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!t.solid)return!1;if(function(t,e){var i,n=A(e);try{for(n.s();!(i=n.n()).done;){var o=i.value;if(!S(t,o)&&R(t,o)){if(t.onCollision&&t.onCollision(o),o.onCollision&&o.onCollision(t),M(t,o))continue;O(t,o)}}}catch(s){n.e(s)}finally{n.f()}}(t,e),t.xVel+t.xVelExt!==0||t.yVel+t.yVelExt!==0){for(var n=t.xVel+t.xVelExt,o=t.yVel+t.yVelExt,s=t.hitbox?t.hitbox:t,r={x:n>0?s.x:s.x+n*i,y:o>0?s.y:s.y+o*i,w:n>0?s.w+n*i:s.w-n*i,h:o>0?s.h+o*i:s.h-o*i},a=[],h={value:0},l={x:0,y:0},u={x:0,y:0},c=0;c<e.length;c++){var f=e[c];if(!S(t,f))if(R(r,f))if(P(s,f.hitbox?f.hitbox:f,n,o,i,l,u,h)){if(t.onCollision&&t.onCollision(f,e),M(t,f))continue;a.push({id:c,ct:h.value})}}if(0!==a.length){a.sort((function(t,e){return t.ct-e.ct}));for(var d=0,y=a;d<y.length;d++){V(t,i,e[y[d].id])}}}}function V(t,e,i){var n={x:0,y:0},o={value:0},s=t.xVel+t.xVelExt,r=t.yVel+t.yVelExt;if(P(t.hitbox?t.hitbox:t,i.hitbox?i.hitbox:i,s,r,e,{x:0,y:0},n,o)){var a=1.001;return t.xVel+=n.x*Math.abs(t.xVel)*(1-o.value)*a,t.yVel+=n.y*Math.abs(t.yVel)*(1-o.value)*a,t.xVelExt+=n.x*Math.abs(t.xVelExt)*(1-o.value)*a,t.yVelExt+=n.y*Math.abs(t.yVelExt)*(1-o.value)*a,!0}return!1}function P(t,e,i,n,o,s,r,a){if(0==i&&0==n)return!1;a.value=0;var h={x:e.x-t.w/2,y:e.y-t.h/2,w:e.w+t.w,h:e.h+t.h};return!!function(t,e,i,n,o,s){n.x=0,n.y=0,o.x=0,o.y=0;var r={x:1/e.x,y:1/e.y},a={x:(i.x-t.x)*r.x,y:(i.y-t.y)*r.y},h={x:(i.x+i.w-t.x)*r.x,y:(i.y+i.h-t.y)*r.y};if(isNaN(h.y)||isNaN(h.x))return!1;if(isNaN(a.y)||isNaN(a.x))return!1;if(a.x>h.x){var l=a.x;a.x=h.x,h.x=l}if(a.y>h.y){var u=a.y;a.y=h.y,h.y=u}if(a.x>h.y||a.y>h.x)return!1;if(s.value=Math.max(a.x,a.y),Math.min(h.x,h.y)<0)return!1;n.x=t.x+s.value*e.x,n.y=t.y+s.value*e.y,a.x>a.y?r.x<0?(o.x=1,o.y=0):(o.x=-1,o.y=0):a.x<a.y&&(r.y<0?(o.x=0,o.y=1):(o.x=0,o.y=-1));return!0}({x:t.x+t.w/2,y:t.y+t.h/2},{x:i*o,y:n*o},h,s,r,a)&&(a.value>=0&&a.value<1)}function S(t,e){return!(!e.removed&&e!=t)}function M(t,e){return!(e.solid&&!e.removed&&e!=t&&(!e.grounded||t.grounded))}function R(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.hitbox&&!i?t.hitbox:t,o=e.hitbox&&!i?e.hitbox:e;return n.x<o.x+o.w&&n.x+n.w>o.x&&n.y<o.y+o.h&&n.y+n.h>o.y}function O(t,e){if(null==t||null==e)return!0;var i=t.hitbox||t,n=e.hitbox||e,o=i.x+i.w/2-(n.x+n.w/2),s=i.y+i.h/2-(n.y+n.h/2),r=i.w/2+n.w/2,a=i.h/2+n.h/2,h="";if(Math.abs(o)<r&&Math.abs(s)<a){var l=r-Math.abs(o),u=a-Math.abs(s);l>=u?s>0?(h="t",t.col.T<u&&u>.01&&(t.col.T+=u)):(h="b",t.col.B<u&&u>.01&&(t.col.B+=u)):o>0?(h="l",t.col.L<l&&l>.01&&(t.col.L+=l)):(h="r",t.col.R<l&&l>.01&&(t.col.R+=l))}return h}function E(t,e){var i=[],n=[];if(1==t.length)return t;for(var o=0;o<t.length;o++)for(var s=0;s<t[o].w;s++)for(var r=0;r<t[o].h;r++){var a={x:t[o].x+s,y:t[o].y+r,w:1,h:1};W(e,a)&&n.push(a)}if(0==n.length)return[];var h,l,u={x:n[0].x,y:n[0].y,w:n[0].w,h:n[0].h};i.push(u);for(var c=0;c<n.length;c++)for(var f=0;f<i.length;f++)if(h=void 0!==n[c].hitbox?n[c].hitbox:n[c],l=i[f],h.y==l.y&&h.h==l.h)h.x+h.w>l.x+l.w&&(l.w=h.x+h.w-l.x),h.x<l.x&&(l.w+=l.x-h.x,l.x=h.x);else if(h.x==l.x&&h.w==l.w)h.y+h.h>l.y+l.h&&(l.h=h.y+h.h-l.y),h.y<l.y&&(l.h+=l.y-h.y,l.y=h.y);else{var d={x:h.x,y:h.y,w:h.w,h:h.h};i.push(d)}return i}function W(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n="undefined"===typeof t.hitbox||i?t:t.hitbox,o="undefined"===typeof e.hitbox||i?e:e.hitbox;return n.x<o.x+o.w&&n.x+n.w>o.x&&n.y<o.y+o.h&&n.y+n.h>o.y}function z(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.hitbox&&!i?e.hitbox:e;return t.x>=n.x&&t.x<=n.x+n.w&&t.y>=n.y&&t.y<=n.y+n.h}function T(t,e){for(var i=X(e),n=0;n<i.length;n++)if(C(i[n].x1,i[n].y1,i[n].x2,i[n].y2,t.x1,t.y1,t.x2,t.y2))return!0;return!1}function C(t,e,i,n,o,s,r,a){if(t===i&&e===n||o===r&&s===a)return!1;var h=(a-s)*(i-t)-(r-o)*(n-e);if(0===h)return!1;var l=((r-o)*(e-s)-(a-s)*(t-o))/h,u=((i-t)*(e-s)-(n-e)*(t-o))/h;return!(l<0||l>1||u<0||u>1)&&{x:t+l*(i-t),y:e+l*(n-e)}}function X(t){var e=[],i=t;return void 0!==t.hitbox&&(i=t.hitbox),e.push({x1:i.x,y1:i.y,x2:i.x+i.w,y2:i.y}),e.push({x1:i.x+i.w,y1:i.y,x2:i.x+i.w,y2:i.y+i.h}),e.push({x1:i.x+i.w,y1:i.y+i.h,x2:i.x,y2:i.y+i.h}),e.push({x1:i.x,y1:i.y+i.h,x2:i.x,y2:i.y}),e}function L(t){var e=t.x1,i=t.y1,n=t.x2-e,o=t.y2-i;return Math.atan2(o,n)}function Y(t,e){var i=t.x,n=(t.w,t.y),o=(t.h,e.x),s=e.w,r=e.y,a=e.h,h=o+s/2-(i+s/2),l=r+a/2-(n+a/2);return Math.atan2(l,h)}function j(t){var e=L({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2});return[Math.cos(e),Math.sin(e)]}function I(t,e){return L({x1:t.x+t.w/2,y1:t.y+t.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2})}function D(t,e){var i=t.w?t.x+t.w/2:t.x,n=t.h?t.y+t.h/2:t.y,o=e.w?e.x+e.w/2:e.x,s=e.h?e.y+e.h/2:e.y;return Math.sqrt(Math.pow(i-o,2)+Math.pow(n-s,2))}var N=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ad2f45",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"center",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"middle";u(this,t),this.content="",this.x=void 0,this.y=void 0,this.color=void 0,this.align=void 0,this.baseline=void 0,this.fontSize=7,this.font="Consolas, monaco, monospace",this.shadow=!1,this.shadowColor="#14182e",this.strokeWidth=.3,this.stroke=void 0,this.strokeColor=void 0,this.x=e,this.y=i,this.color=n,this.align=o,this.stroke=!1,this.baseline=s,this.strokeColor="#ffffff"}return l(t,[{key:"shadowOffsetX",get:function(){return this.fontSize/200}},{key:"shadowOffsetY",get:function(){return this.fontSize/200}},{key:"canvasFont",value:function(t){return"bold "+Math.round(this.fontSize*t)+"px "+this.font}},{key:"render",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};if(this.stroke&&(t.lineWidth=this.strokeWidth*i,t.strokeStyle=this.strokeColor),t.textBaseline=this.baseline,t.textAlign=this.align,t.fillStyle=this.color,t.font=this.canvasFont(i),"string"!==typeof this.content)for(var o=0;o<this.content.length;o++)this.stroke&&t.strokeText(this.content[o],(this.x+n.x)*e*i,((this.y+n.y)*e+this.fontSize*o)*i),this.shadow&&(t.fillStyle=this.shadowColor,t.fillText(this.content[o],(this.x+n.x+this.shadowOffsetX)*e*i,((this.y+n.y+this.shadowOffsetY)*e+this.fontSize*o)*i)),t.fillStyle=this.color,t.fillText(this.content[o],(this.x+n.x)*e*i,((this.y+n.y)*e+this.fontSize*o)*i);else this.stroke&&t.strokeText(this.content,(this.x+n.x)*e*i,(this.y+n.y)*e*i),this.shadow&&(t.fillStyle=this.shadowColor,t.fillText(this.content,(this.x+n.x+this.shadowOffsetX)*e*i,(this.y+n.y+this.shadowOffsetY)*e*i)),t.fillStyle=this.color,t.fillText(this.content,(this.x+n.x)*e*i,(this.y+n.y)*e*i)}}]),t}(),Z=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t.centerX,t.centerY)).source=void 0,n.type="vfx",n.name="proto",n.removed=!1,n.randomPos=!1,n.randomAmount=.5,n.source=t,n}return l(i,[{key:"resolveCollisions",value:function(){}},{key:"renderShadow",value:function(){}},{key:"randomizePos",value:function(){this.x+=Math.random()*this.randomAmount-this.randomAmount/2,this.y+=Math.random()*this.randomAmount-this.randomAmount/2}},{key:"reset",value:function(t){this.source=t,this.moveAtSource(),this.randomPos&&this.randomizePos(),this.removed=!1,this.frame=0,this.frameCounter=0,this.additionalResetOperations()}},{key:"additionalResetOperations",value:function(){}},{key:"moveAtSource",value:function(){this.x=this.source.centerX-this.w/2,this.y=this.source.centerY-this.h/2}},{key:"compute",value:function(t){this.updateSprite(t)}},{key:"render",value:function(t,e,i,n){this.renderSprite(t,e,i,n)}},{key:"onAnimationEnd",value:function(){this.removed=!0}}]),i}(p),K=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t)).name="DmgVfx",n.w=1,n.h=1,n.randomPos=!0,n.randomizePos(),n.setAnimation("boom",[17,17,17,17],[0,1,2,3]),n.setAnimation("cut",[18,18,18,18],[0,1,2,3]),n.setAnimation("cut_long",[20,20,20,20],[0,1,2,3]),n.animations.cut_long.w=2,n.additionalResetOperations(),n}return l(i,[{key:"additionalResetOperations",value:function(){var t=Object.entries(this.animations);this.animation=t[Math.random()*t.length|0][0];var e=[0,90,180,-90];this.rot=e[Math.random()*e.length|0]}}]),i}(Z),F=function(t){d(i,t);var e=x(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return u(this,i),(n=e.call(this,t.x,t.y)).verticalSpeed=-.03,n.x=void 0,n.y=void 0,n.source=void 0,n.lifeCycles=void 0,n.remainingCycles=void 0,n.setAnimation("idle",[19,19,19,19],[0,1,2,3]),n.source=t,n.lifeCycles=o,n.remainingCycles=n.lifeCycles,n.x=t.x+t.w/2+1.5*Math.random()-.75-n.w/2,n.y=t.y+t.h/2+1.5*Math.random()-.75-n.h/2,n.x-=n.w/2,n.y-=n.h/2,n}return l(i,[{key:"randomX",get:function(){return this.source.x+this.source.w/2+1.5*Math.random()-.75-this.w/2}},{key:"randomY",get:function(){return this.source.y+this.source.h/2+1.5*Math.random()-.75-this.h/2}},{key:"reset",value:function(t,e){this.source=t,this.x=this.randomX,this.y=this.randomY,this.removed=!1,this.remainingCycles=e||this.lifeCycles}},{key:"onAnimationEnd",value:function(){this.remainingCycles--,this.remainingCycles<=0?this.removed=!0:(this.x=this.randomX,this.y=this.randomY)}},{key:"compute",value:function(t){this.y+=this.verticalSpeed*t,this.updateSprite(t)}},{key:"render",value:function(t,e,i,n){this.renderSprite(t,e,i,n)}}]),i}(p),q=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t)).particlesDuration=5,n.particlesAmount=5,n.particles=[],n.name="ParticlesVfx",n.particlesDuration=5,n.particlesAmount=5,n.particles=[],n.initialize(),n}return l(i,[{key:"initialize",value:function(){for(var t=0;t<this.particlesAmount;t++)this.particles.push(new F(this.source,this.particlesDuration))}},{key:"additionalResetOperations",value:function(){var t,e=A(this.particles);try{for(e.s();!(t=e.n()).done;){t.value.reset(this.source,this.particlesDuration)}}catch(i){e.e(i)}finally{e.f()}}},{key:"compute",value:function(t){var e,i=0,n=A(this.particles);try{for(n.s();!(e=n.n()).done;){var o=e.value;o.removed?i++:o.compute(t)}}catch(s){n.e(s)}finally{n.f()}i===this.particles.length&&(this.removed=!0)}},{key:"render",value:function(t,e,i,n){var o,s=A(this.particles);try{for(s.s();!(o=s.n()).done;){var r=o.value;r.removed||r.render(t,e,i,n)}}catch(a){s.e(a)}finally{s.f()}}}]),i}(Z),H=function(t){d(i,t);var e=x(i);function i(t){var n;return u(this,i),(n=e.call(this,t)).name="TextVfx",n.text=new N(0,0),n.progress=0,n.text.content="",n.text.color="#ad2f45",n.text.shadow=!0,n.text.fontSize=10,n}return l(i,[{key:"reset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.removed=!1,this.progress=0,this.text.content=e,this.source=t}},{key:"compute",value:function(t){this.progress+=Math.PI/60*t,this.progress>=Math.PI?this.removed=!0:(this.x=this.source.centerX+this.progress/10,this.y=this.source.centerY-Math.sin(this.progress),this.text.x=this.x,this.text.y=this.y)}},{key:"render",value:function(t,e,i,n){this.text.render(t,e,i,n)}}]),i}(Z),U=new(function(){function t(){var e=this;u(this,t),this.recyclePool=[],this.environment=[],this.vfxClasses=a({},i),this.create=function(t,i){var n=e.getRecycledVfx(t,i)||new e.vfxClasses[t](i);return e.environment.push(n),n}}return l(t,[{key:"setEnvironment",value:function(t){this.environment=t}},{key:"getRecycledVfx",value:function(t,e){for(var i=this.recyclePool.length-1;i>=0;i--)if(this.recyclePool[i].name===t)return this.recyclePool[i].reset(e),this.recyclePool.splice(i,1)[0];return!1}}]),t}()),B=l((function t(){var e=this;u(this,t),this.playbackRate=1,this.volume=1,this.sounds={playRandom:function(t){e.sounds[t[Math.random()*t.length|0]].play()}},this.soundsBaseUrl="assets/soundFxs/",this.createSound=function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s="".concat(e.soundsBaseUrl).concat(t,".mp3"),r=t.split("/"),a=r[r.length-1];e.sounds[a]=new Q(s,i,n,o)}})),Q=l((function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;u(this,t),this.audio=void 0,this.loop=!1,this.volume=1,this.playbackRate=1,this.calledPlayPromise=!1,this.play=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(i.calledPlayPromise)return!1;if(i.audio.volume=i.volume*t,i.audio.loop=i.loop,i.audio.playbackRate=i.playbackRate*e,i.audio.paused)i.audio.loop||(i.audio.currentTime=0);else{if(i.audio.loop)return;i.audio.pause(),i.audio.currentTime=0}var n=i.audio.play();i.calledPlayPromise=!0,void 0!==n&&n.catch((function(t){console.warn("there was an audio error!",t),i.calledPlayPromise=!1})).then((function(){i.calledPlayPromise=!1}))},this.audio=new Audio(e),this.loop=n,this.volume=o,this.playbackRate=s})),G=new B,J=function(t){d(n,t);var i=x(n);function n(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u(this,n),(t=i.call(this,o,s)).xVel=0,t.yVel=0,t.xVelExt=0,t.yVelExt=0,t.speed=.1,t.inertia=0,t.type="entity",t.state="idle",t.sounds=G.sounds,t.stats=new _,t.background=!1,t.grounded=!1,t.damaged=0,t.shadow=!1,t.solid=!0,t.removed=!1,t.immovable=!1,t.drops=[],t.offsetX=0,t.offsetY=0,t.Physics=e,t.hasHpBar=!1,t.hasDisplayName=!1,t.col={L:0,R:0,T:0,B:0},t.hitbox={x:0,y:0,w:0,h:0},t.hitboxOffset={x:0,y:0,w:0,h:0},t.createVfx=U.create,t.checkCollisions=k,t.updateHitbox(),t}return l(n,[{key:"atk",get:function(){return this.stats.atk}},{key:"hp",get:function(){return this.stats.hp},set:function(t){this.stats.hp=t}},{key:"updateHitbox",value:function(){this.hitbox.x=this.x+this.hitboxOffset.x,this.hitbox.y=this.y+this.hitboxOffset.y,this.hitbox.w=this.w+this.hitboxOffset.w,this.hitbox.h=this.h+this.hitboxOffset.h}},{key:"onCollision",value:function(t){}},{key:"resolveCollisions",value:function(){this.col.L&&this.xVel+this.xVelExt<0&&(this.xVel=0,this.xVelExt=0),this.col.R&&this.xVel+this.xVelExt>0&&(this.xVel=0,this.xVelExt=0),this.col.T&&this.yVel+this.yVelExt<0&&(this.yVel=0,this.yVelExt=0),this.col.B&&this.yVel+this.yVelExt>0&&(this.yVel=0,this.yVelExt=0),this.col.L=0,this.col.R=0,this.col.T=0,this.col.B=0}},{key:"onHit",value:function(t){this.xVelExt=t.xVel,this.yVelExt=t.yVel}},{key:"updateVelocities",value:function(t){0!==this.xVelExt&&(this.xVelExt*=Math.pow(this.inertia,t),Math.abs(this.xVelExt)<.001&&(this.xVelExt=0)),0!==this.yVelExt&&(this.yVelExt*=Math.pow(this.inertia,t),Math.abs(this.yVelExt)<.001&&(this.yVelExt=0))}},{key:"updatePosition",value:function(t){this.resolveCollisions(),this.x+=(this.xVel+this.xVelExt)*t,this.y+=(this.yVel+this.yVelExt)*t}},{key:"compute",value:function(t){}},{key:"render",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};this.renderSprite(t,e,i,n)}},{key:"renderHitbox",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};t.strokeStyle="red",t.beginPath(),t.strokeRect((this.hitbox.x+n.x)*e*i,(this.hitbox.y+n.y)*e*i,this.hitbox.w*e*i,this.hitbox.h*e*i),t.closePath(),t.stroke()}},{key:"renderShadow",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{x:0,y:0};this.shadow&&!this.removed&&(t.fillStyle="#14182e",t.globalAlpha=.6,t.strokeStyle="#ffffff",t.beginPath(),t.ellipse((this.x+n.x+this.w/2)*e*i,(this.y+this.h+n.y)*e*i,this.w/2*e*i,this.w/4*e*i,0,0,2*Math.PI),t.closePath(),t.fill(),t.globalAlpha=1)}}]),n}(p),_=l((function t(){u(this,t),this.lv=void 0,this.maxHp=void 0,this.hp=void 0,this.maxExp=void 0,this.exp=void 0,this.maxMana=void 0,this.mana=void 0,this.atk=void 0,this.atkSpeed=void 0,this.expValue=void 0,this.lv=1,this.maxHp=10,this.hp=this.maxHp,this.maxExp=10,this.exp=0,this.maxMana=15,this.mana=this.maxMana,this.atk=1,this.atkSpeed=1,this.expValue=1})),$=J,tt=function(){function t(){u(this,t),this.up=void 0,this.down=void 0,this.left=void 0,this.right=void 0,this.upR=void 0,this.downR=void 0,this.leftR=void 0,this.rightR=void 0,this.spacebar=void 0,this.e=void 0,this.r=void 0,this.lClickDown=void 0,this.mClickDown=void 0,this.rClickDown=void 0,this.test=void 0,this.currentPos=void 0,this.lastDir=void 0,this.mouseX=void 0,this.mouseY=void 0,this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.upR=!1,this.downR=!1,this.leftR=!1,this.rightR=!1,this.spacebar=!1,this.e=!1,this.r=!1,this.lClickDown=!1,this.mClickDown=!1,this.rClickDown=!1,this.test="test",this.currentPos=0,this.lastDir=0,this.mouseX=0,this.mouseY=0,this.initListeners()}return l(t,[{key:"initListeners",value:function(){document.addEventListener("mousedown",n),document.addEventListener("mouseup",n),document.addEventListener("touchstart",i),document.addEventListener("touchend",i),document.addEventListener("keydown",e),document.addEventListener("keyup",e);var t=this;function e(e){var i="keydown"===e.type;switch(e.key){case"w":t.up=i;break;case"s":t.down=i;break;case"a":t.left=i;break;case"d":t.right=i;break;case"ArrowUp":t.upR=i;break;case"ArrowDown":t.downR=i;break;case"ArrowLeft":t.leftR=i;break;case"ArrowRight":t.rightR=i;break;case" ":t.spacebar=i;break;case"e":t.e=i;break;case"r":t.r=i;break;case"Escape":case"y":break;default:console.log('Pressed "'.concat(e.key,'" key'))}}function i(e){console.log(e);var i="touchstart"===e.type;t.lClickDown=i,i&&(t.mouseX=e.touches[0].clientX,t.mouseY=e.touches[0].clientY)}function n(e){var i="mousedown"===e.type;switch(e.button){case 0:t.lClickDown=i;break;case 1:t.mClickDown=i;break;case 2:t.rClickDown=i}t.mouseX=e.clientX,t.mouseY=e.clientY}}}]),t}(),et=l((function t(e,i,n){var o=this;u(this,t),this.x=0,this.y=0,this.gui={x:0,y:0},this.guiRef={ratio:1},this.canvas=void 0,this.meta=void 0,this.camera=void 0,this.absolute={x:0,y:0,hoverUI:!1,dragging:!1,slot:{}},this.lastMouseX=0,this.lastMouseY=0,this.setCanvas=function(t){o.canvas=t},this.updatePos=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clientX:o.lastMouseX,clientY:o.lastMouseY};o.canvas&&(o.lastMouseX=t.clientX,o.lastMouseY=t.clientY,o.absolute.x=(t.clientX-o.canvas.offsetLeft)/o.meta.tilesize/o.meta.ratio,o.absolute.y=(t.clientY-o.canvas.offsetTop)/o.meta.tilesize/o.meta.ratio,o.x=o.absolute.x-o.camera.x,o.y=o.absolute.y-o.camera.y,o.gui.x=o.absolute.x*o.meta.ratio/o.guiRef.ratio,o.gui.y=o.absolute.y*o.meta.ratio/o.guiRef.ratio)},this.updatePosMobile=function(t){o.canvas&&0!==t.touches.length&&(o.lastMouseX=t.touches[0].clientX,o.lastMouseY=t.touches[0].clientY,o.absolute.x=(t.touches[0].clientX-o.canvas.offsetLeft)/o.meta.tilesize/o.meta.ratio,o.absolute.y=(t.touches[0].clientY-o.canvas.offsetTop)/o.meta.tilesize/o.meta.ratio,o.x=o.absolute.x-o.camera.x,o.y=o.absolute.y-o.camera.y,o.gui.x=o.absolute.x*o.meta.ratio/o.guiRef.ratio,o.gui.y=o.absolute.y*o.meta.ratio/o.guiRef.ratio)},this.canvas=e,this.meta=i,this.camera=n,document.addEventListener("mousemove",this.updatePos),document.addEventListener("touchstart",this.updatePosMobile)}));function it(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,o,s,r,a=[],h=!0,l=!1;try{if(s=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;h=!1}else for(;!(h=(n=s.call(i)).done)&&(a.push(n.value),a.length!==e);h=!0);}catch(u){l=!0,o=u}finally{try{if(!h&&null!=i.return&&(r=i.return(),Object(r)!==r))return}finally{if(l)throw o}}return a}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var nt=l((function t(){var e=this;u(this,t),this.div=void 0,this.activateButton=void 0,this.window=void 0,this.active=void 0,this.times=void 0,this.drawLater=void 0,this.drawRect=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";e.active&&e.drawLater.push({color:i,type:"rect",x:t.x,y:t.y,w:t.w,h:t.h})},this.drawPoint=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"red";e.active&&e.drawLater.push({color:i,type:"point",x:t.x-.1,y:t.y-.1,w:.2,h:.2})},this.drawLine=function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"red";e.active&&e.drawLater.push({color:n,type:"line",x1:t.x,y1:t.y,x2:i.x,y2:i.y})},this.render=function(t,i,n,o){if(e.active){var s,r=A(e.drawLater);try{for(r.s();!(s=r.n()).done;){var a=s.value;switch(t.beginPath(),t.strokeStyle=a.color,a.type){case"point":case"rect":t.rect((a.x+o.x)*i*n,(a.y+o.y)*i*n,a.w*i*n,a.h*i*n);break;case"line":t.moveTo((a.x1+o.x)*i*n,(a.y1+o.y)*i*n),t.lineTo((a.x2+o.x)*i*n,(a.y2+o.y)*i*n)}t.closePath(),t.stroke()}}catch(h){r.e(h)}finally{r.f()}e.drawLater.length=0}},this.printTime=function(){e.active&&(e.div.innerHTML="Function time: ".concat(e.averageTime().toFixed(4),"ms"),e.times.length=0)},this.inspect=function(t){e.active&&(e.div.innerHTML='<table style="color:white;">\n        '.concat(Object.entries(t).reduce((function(t,e){var i=it(e,2),n=i[0],o=i[1];return["object","function"].includes(typeof o)?t:t+"<tr><td>".concat(n,"</td><td>").concat(o,"</td></tr>")}),""),"\n      </table>\n      "))},this.measureTime=function(t){if(e.active){e.active||e.activate();for(var i=performance.now(),n=arguments.length,o=new Array(n>1?n-1:0),s=1;s<n;s++)o[s-1]=arguments[s];t.apply(void 0,o),e.times.push(performance.now()-i)}},this.activate=function(){e.createWindow(600,600),e.active=!0,e.activateButton.onclick=e.deactivate,e.activateButton.innerText="DEACTIVATE DEBUG"},this.deactivate=function(){e.window&&(e.window.close(),e.window=null),e.active=!1,e.activateButton.onclick=e.activate,e.activateButton.innerText="ACTIVATE DEBUG"},this.averageTime=function(){var t,i=0,n=A(e.times);try{for(n.s();!(t=n.n()).done;){i+=t.value}}catch(o){n.e(o)}finally{n.f()}return i/e.times.length},this.createWindow=function(t,i){e.window=window.open("","targetWindow","noopener=false,noreferrer=false,popup,width=".concat(t,",height=").concat(i)),e.window&&(e.active=!0,e.window.document.body.style.margin="0",e.window.document.body.style.padding="0",e.window.window.document.body.style.boxSizing="border-box",e.window.window.document.body.style.backgroundColor="black",e.window.window.document.body.style.color="white",e.window.window.document.body.style.padding="10px",e.window.document.title="debugger",e.window.document.body.innerHTML="",e.window.document.body.appendChild(e.div),e.window.onbeforeunload=e.deactivate,e.window.addEventListener("keydown",(function(t){var i;"F2"===t.key&&(null===(i=e.window)||void 0===i||i.close())})))},this.createDiv=function(){var t=document.createElement("div");return t.style.position="absolute",t.style.inset="0",t.style.fontFamily='"Lucida Console", "Courier New", monospace',t},this.createActivateButton=function(){var t=document.createElement("button");return t.innerText="ACTIVATE DEBUG",t.style.position="absolute",t.style.top="20px",t.style.right="20px",t.onclick=function(){return e.activate()},window.document.body.appendChild(t),window.addEventListener("keydown",(function(e){if("F2"===e.key){var i=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});t.dispatchEvent(i)}})),t},this.div=this.createDiv(),this.active=!1,this.times=[],this.drawLater=[],this.window=null,this.activateButton=this.createActivateButton()})),ot=new nt,st=function(t){d(i,t);var e=x(i);function i(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:function(){return 0},y:function(){return 0},rot:function(){return 0},delay:function(){return 12}};return u(this,i),(n=e.call(this,t.x,t.y)).source=void 0,n.offsetPositioning=void 0,n.rot=t.rot,n.w=1,n.h=1,n.source=t,n.offsetPositioning=o,n.setAnimation("idle",[4],[0]),n.setAnimation("attack",[4],[1]),n.setAnimation("defend",[4],[2]),n}return l(i,[{key:"follow",value:function(t){var e=this.source.x+this.offsetPositioning.x(),i=this.source.y+this.offsetPositioning.y();this.x+=(e+this.source.w/2-this.w/2-this.x)/this.offsetPositioning.delay()*t,this.y+=(i+this.source.h/2-this.h/2-this.y)/this.offsetPositioning.delay()*t;var n=this.source.rot+this.offsetPositioning.rot();n-this.rot>Math.PI?this.rot+=2*Math.PI:n-this.rot<-Math.PI?this.rot-=2*Math.PI:this.rot+=(n-this.rot)/this.offsetPositioning.delay()*t}},{key:"attack",value:function(){}},{key:"render",value:function(t,e,i,n){var o={x:this.w/2,y:this.h/2};this.renderSprite(t,e,i,n,o)}}]),i}($),rt=st,at=function(t){d(i,t);var e=x(i);function i(t,n,o,s,r){var h;return u(this,i),(h=e.call(this,t,n)).controls=void 0,h.mouse=void 0,h.mantle=void 0,h.skirt=void 0,h.swords=void 0,h.swordsOffsets=void 0,h.stance=void 0,h.resolveInputs=function(){h.stance="idle",h.swords.forEach((function(t){return t.loadAnimation("idle")})),h.controls.rClickDown&&"defend"!==h.stance&&(h.swords[0].offsetPositioning=a({},h.swordsOffsets.attack0[0]),h.swords[1].offsetPositioning=a({},h.swordsOffsets.attack0[1]),h.swords[0].loadAnimation("attack"),h.stance="attack0"),h.controls.lClickDown&&"defend"!==h.stance&&(h.swords[0].offsetPositioning=a({},h.swordsOffsets.attack1[0]),h.swords[1].offsetPositioning=a({},h.swordsOffsets.attack1[1]),h.swords[1].loadAnimation("attack"),h.stance="attack1"),h.controls.lClickDown&&h.controls.rClickDown&&(h.swords[0].offsetPositioning=a({},h.swordsOffsets.defend[0]),h.swords[1].offsetPositioning=a({},h.swordsOffsets.defend[1]),h.swords.forEach((function(t){return t.loadAnimation("defend")})),h.stance="defend"),"idle"===h.stance&&h.swords[0].offsetPositioning.x()!==h.swordsOffsets.idle[1].x()&&(h.swords[0].offsetPositioning=a({},h.swordsOffsets.idle[0]),h.swords[1].offsetPositioning=a({},h.swordsOffsets.idle[1])),[c(h),h.mantle,h.swords[0],h.swords[1],h.skirt].forEach((function(t){return t.trackPos=!1})),h.controls.e?([c(h),h.mantle,h.swords[0],h.swords[1],h.skirt].forEach((function(t){return t.trackPos=!0})),h.xVelExt=.6*Math.cos(h.rot),h.yVelExt=.6*Math.sin(h.rot)):h.xVelExt||h.yVelExt||[c(h),h.mantle,h.swords[0],h.swords[1],h.skirt].forEach((function(t){t.trackPos=!1})),!h.controls.left||h.controls.right||h.col.L?h.xVel<0&&(h.xVel=0):(h.xVel=-h.speed,h.left=1),!h.controls.right||h.controls.left||h.col.R?h.xVel>0&&(h.xVel=0):(h.xVel=h.speed,h.left=0),!h.controls.up||h.controls.down||h.col.B?h.yVel<0&&(h.yVel=0):h.yVel=-h.speed,!h.controls.down||h.controls.up||h.col.T?h.yVel>0&&(h.yVel=0):h.yVel=h.speed,h.controls.left||h.controls.right||h.controls.up||h.controls.down||(h.xVel=0,h.yVel=0),+h.controls.left+ +h.controls.right+ +h.controls.up+ +h.controls.down>1&&(h.xVel/=1.42,h.yVel/=1.42)},h.compute=function(t){h.rot=h.Physics.getAngle({x1:h.x+h.w/2,y1:h.y+h.h/2,x2:h.mouse.x,y2:h.mouse.y})+2*Math.PI,h.resolveInputs(),h.updateVelocities(t),h.updatePosition(t),h.updateHitbox(),h.swords[0].follow(t),h.swords[1].follow(t),h.updatePropPosition(h.mantle,t,3),h.updatePropPosition(h.skirt,t,5),ot.inspect(c(h)),ot.drawPoint(h.centerPoint),ot.drawPoint(h.mouse,"green"),ot.drawLine(h.centerPoint,h.mouse,"pink")},h.render=function(t,e,i,n){if(h.prevPos.length){h.controls.e&&(t.filter="brightness(50%)");var o={x:h.w/2,y:h.h/2};[h.skirt,h.mantle,h.swords[0],h.swords[1],c(h)].forEach((function(s){s.prevPos.forEach((function(r,a){s.renderSprite(t,e,i,n,o,r),r.opacity-=.03,r.opacity<=0&&s.prevPos.splice(a,1)}))}))}h.skirt.renderSprite(t,e,i,n),h.mantle.renderSprite(t,e,i,n),h.renderArm(h.swords[0],t,e,i,n),h.renderArm(h.swords[1],t,e,i,n),h.swords[0].renderSprite(t,e,i,n),h.swords[1].renderSprite(t,e,i,n),h.renderSprite(t,e,i,n),t.fillStyle="red",t.fillStyle="black",t.filter="none"},h.updatePropPosition=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;t.updateSprite(e),t.x+=(h.x+h.w/2-t.w/2-t.x)/i*e,t.y+=(h.y+h.h/2-t.h/2-t.y)/i*e;var n=h.rot;n-t.rot>Math.PI?t.rot+=2*Math.PI:n-t.rot<-Math.PI?t.rot-=2*Math.PI:t.rot+=(n-t.rot)/i*e},h.renderArm=function(t,e,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0};e.beginPath();var s=t===h.swords[0]?Math.PI-Math.PI/4:-Math.PI+Math.PI/4,r=.5*Math.cos(h.rot+s),a=.5*Math.sin(h.rot+s);e.moveTo((h.centerPoint.x+r+o.x)*i*n,(h.centerPoint.y+a+o.y)*i*n);var l=Math.PI-Math.PI/4,u=.5*Math.cos(t.rot+l),c=.5*Math.sin(t.rot+l);e.lineTo((t.centerPoint.x+u+o.x)*i*n,(t.centerPoint.y+c+o.y)*i*n),e.closePath(),e.strokeStyle="#f5a097",e.lineWidth=8,e.stroke(),e.strokeStyle="#fef3c0",e.lineWidth=4,e.stroke()},h.stance="idle",h.inertia=.8,h.swordsOffsets=lt(c(h)),h.swords=[new rt(c(h),a({},h.swordsOffsets.idle[0])),new rt(c(h),a({},h.swordsOffsets.idle[1]))],h.mouse=new et(o,s,r),h.controls=new tt,h.w=2,h.h=2,h.setAnimation("idle",[0],[0]),h.prevPos=[],h.mantle=new p(h.x,h.y),h.mantle.w=2,h.mantle.h=2,h.mantle.setAnimation("idle",[0],[2]),h.skirt=new p(h.x,h.y),h.skirt.w=2,h.skirt.h=2,h.skirt.setAnimation("idle",[0],[4]),h}return l(i)}(J),ht=at,lt=function(t){return{idle:[{x:function(){return Math.cos(t.rot+1.5)},y:function(){return Math.sin(t.rot+1.5)},rot:function(){return Math.PI/2},delay:function(){return 8}},{x:function(){return Math.cos(t.rot-1.5)},y:function(){return Math.sin(t.rot-1.5)},rot:function(){return 2*Math.PI},delay:function(){return 8}}],defend:[{x:function(){return.9*Math.cos(t.rot+.3)},y:function(){return.9*Math.sin(t.rot+.3)},rot:function(){return-.3},delay:function(){return 3}},{x:function(){return.9*Math.cos(t.rot-.3)},y:function(){return.9*Math.sin(t.rot-.3)},rot:function(){return Math.PI/2+.3},delay:function(){return 3}}],attack0:[{x:function(){return 1.7*Math.cos(t.rot)},y:function(){return 1.7*Math.sin(t.rot)},rot:function(){return Math.PI/4},delay:function(){return 3}},{x:function(){return.8*Math.cos(t.rot-2)},y:function(){return.8*Math.sin(t.rot-2)},rot:function(){return 2*Math.PI},delay:function(){return 5}}],attack1:[{x:function(){return.8*Math.cos(t.rot+2)},y:function(){return.8*Math.sin(t.rot+2)},rot:function(){return Math.PI/2},delay:function(){return 5}},{x:function(){return 1.7*Math.cos(t.rot)},y:function(){return 1.7*Math.sin(t.rot)},rot:function(){return Math.PI/4},delay:function(){return 3}}]}},ut=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,w:0,h:0};u(this,t),this.focus=void 0,this.lockedAngles=!0,this.zoom=!0,this.x=void 0,this.y=void 0,this.shake=0,this.focus=e,this.x=e.x,this.y=e.y}return l(t,[{key:"changeFocus",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.focus=t,e||(this.x=-this.focus.x,this.y=-this.focus.y)}},{key:"compute",value:function(t,e){var i=e;i.w<t.tilesWidth+1&&(i.x-=(t.tilesWidth+1-i.w)/2,i.w=t.tilesWidth+1),i.h<t.tilesHeight+1&&(i.y-=(t.tilesHeight+1-i.h)/2,i.h=t.tilesHeight+1),this.zoom&&t.changeRatio(t.ratio+(t.baseRatio-t.ratio)/22*t.deltaTime);var n=0,o=0;if(this.focus&&(n=-(this.focus.x+this.focus.w/2-t.tilesWidth/2),o=-(this.focus.y+this.focus.h/2-t.tilesHeight/2),this.x+=(n-this.x)/15*t.deltaTime,this.y+=(o-this.y)/15*t.deltaTime),this.lockedAngles){-this.x<i.x&&(n=-i.x,!0),-this.y<i.y&&(o=-i.y,!0),-this.x>i.x+i.w-t.tilesWidth&&(n=-(i.x+i.w-t.tilesWidth),!0),-this.y>i.y+i.h-t.tilesHeight&&(o=-(i.y+i.h-t.tilesHeight),!0)}this.shake>0&&(this.x+=Math.random()/2-.25,this.y+=Math.random()/2-.25,this.shake-=t.deltaTime)}}]),t}(),ct=ut;function ft(t,e,i){return ft=v()?Reflect.construct.bind():function(t,e,i){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return i&&f(o,i.prototype),o},ft.apply(null,arguments)}function dt(t){var e="function"===typeof Map?new Map:void 0;return dt=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return ft(t,arguments,y(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,t)},dt(t)}var yt=function(t){d(i,t);var e=x(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:800,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600;return u(this,i),(t=e.call(this)).context=void 0,t.center=function(){t.style.position="absolute",t.style.left=(window.innerWidth-t.width)/2+"px",t.style.top=(window.innerHeight-t.height)/2+"px"},t.clear=function(){t.context.clearRect(0,0,t.width,t.height)},t.initialize=function(){window.addEventListener("resize",(function(){return t.center()})),t.center(),document.body.appendChild(c(t)),t.context.imageSmoothingEnabled=!1},t.oncontextmenu=function(t){t.preventDefault()},t.width=n,t.height=o,t.context=t.getContext("2d"),t.style.outline="22px inset black",t.initialize(),t}return l(i)}(dt(HTMLCanvasElement));customElements.define("game-canvas",yt,{extends:"canvas"});var vt=yt,xt=l((function t(){var e=this;u(this,t),this.tilesize=16,this.baseRatio=2,this.ratio=this.baseRatio,this.fps=0,this.displayFps=!0,this.deltaTime=1,this.targetFrames=60,this.perfectFrameTime=1e3/this.targetFrames,this.lastTimestamp=Date.now(),this.timestamp=Date.now(),this.loopType=0,this.baseTilesWidth=window.innerWidth/this.tilesize/this.ratio,this.baseTilesHeight=window.innerHeight/this.tilesize/this.ratio,this.tilesWidth=this.baseTilesWidth,this.tilesHeight=this.baseTilesHeight,this.init=function(){if(e.displayFps){var t=document.createElement("span");t.style.position="absolute",t.style.color="black",t.style.fontSize="25px",t.style.fontWeight="bold",t.style.fontFamily='"Lucida Console", "Courier New", monospace',t.style.left="5px",t.style.top="5px",document.body.appendChild(t),setInterval((function(){e.fpsCounter(t)}),1e3)}},this.changeRatio=function(t){e.ratio=t,e.tilesWidth=window.innerWidth/e.tilesize/e.ratio,e.tilesHeight=window.innerHeight/e.tilesize/e.ratio},this.changeBaseRatio=function(t){e.baseRatio=t,e.baseTilesWidth=window.innerWidth/e.tilesize/e.ratio,e.baseTilesHeight=window.innerHeight/e.tilesize/e.ratio},this.compute=function(){e.fps+=1,e.updateDeltaTime()},this.updateDeltaTime=function(){e.lastTimestamp=e.timestamp,e.timestamp=Date.now(),e.deltaTime=(e.timestamp-e.lastTimestamp)/e.perfectFrameTime,e.deltaTime>2&&(e.deltaTime=2)},this.fpsCounter=function(t){t.innerHTML=String(e.fps),e.fps=0},this.init()})),mt=new vt,pt=new xt,wt=new ct,bt=new ht(mt.width/2/pt.tilesize/pt.ratio,mt.height/2/pt.tilesize/pt.ratio,mt,pt,wt);pt.ratio=3;var gt=function(){kt()},At=[bt],kt=function t(){pt.compute(),mt.clear();for(var e=0,i=At;e<i.length;e++){i[e].compute(pt.deltaTime,At)}!function(t){for(var e=0;e<pt.tilesWidth;e+=2)for(var i=0;i<pt.tilesWidth;i+=2)t.drawImage(bt.sheet,0*pt.tilesize,8*pt.tilesize,2*pt.tilesize,2*pt.tilesize,e*pt.tilesize*pt.ratio,i*pt.tilesize*pt.ratio,2*pt.tilesize*pt.ratio,2*pt.tilesize*pt.ratio)}(mt.context),mt.context.drawImage(bt.sheet,8*pt.tilesize,8*pt.tilesize,2*pt.tilesize,2*pt.tilesize,9*pt.tilesize*pt.ratio,9*pt.tilesize*pt.ratio,2*pt.tilesize*pt.ratio,2*pt.tilesize*pt.ratio);for(var n=0,o=At;n<o.length;n++){o[n].render(mt.context,pt.tilesize,pt.ratio,wt)}!function(t){t.drawImage(bt.sheet,2*pt.tilesize,8*pt.tilesize,6*pt.tilesize,2*pt.tilesize,1*pt.tilesize*pt.ratio,.5*pt.tilesize*pt.ratio,6*pt.tilesize*pt.ratio,2*pt.tilesize*pt.ratio)}(mt.context),ot.render(mt.context,pt.tilesize,pt.ratio,wt),requestAnimationFrame(t)};gt(),console.log("Ready")}();
//# sourceMappingURL=main.b5a40406.js.map